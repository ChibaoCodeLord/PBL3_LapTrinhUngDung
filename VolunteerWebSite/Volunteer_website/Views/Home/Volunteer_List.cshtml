@model List<Volunteer_website.ViewModels.Volunteer_List>
@{
    ViewData["Title"] = "Volunteer List";
    Layout = "_Layout";

    // Pagination variables
    int currentPage = ViewBag.CurrentPage ?? 1;
    int pageSize = ViewBag.PageSize ?? 10;
    int totalCount = ViewBag.TotalCount ?? (Model?.Count ?? 0);
    int totalPages = (int)Math.Ceiling((double)totalCount / pageSize);
    int startIndex = (currentPage - 1) * pageSize;
}
<head>
    <link rel="stylesheet" href="~/css/Volunteer_list.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<div class="hero-wrap" style="background-image: url('@Url.Content("~/images/bg_1.jpg")');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-center justify-content-center" data-scrollax-parent="true">
            <div class="col-md-7 ftco-animate text-center" data-scrollax=" properties: { translateY: '70%' }">
                <p class="breadcrumbs" data-scrollax="properties: { translateY: '30%', opacity: 1.6 }">
                    <span class="mr-2"><a href="@Url.Action("Index", "Home")">Home </a></span>
                    <span>Volunteer</span>
                </p>
                <h1 class="mb-3 bread" data-scrollax="properties: { translateY: '30%', opacity: 1.6 }">Volunteer</h1>
            </div>
        </div>
    </div>
</div>

<section class="volunteer-section">
    <div class="container">
        <div class="row justify-content-center mb-5">
            <div class="col-md-8 text-center">
                <h2 class="mb-4" style="color: #007bbf; font-weight: 700; font-size: 2.5rem;">Danh sách Volunteer</h2>
                <p style="color: #546e7a; font-size: 1.1rem;">Quản lý và theo dõi thông tin các tình nguyện viên</p>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <form class="search-form" method="get">
                <input type="text" class="search-input" name="searchTerm" id="liveSearch" placeholder="Tìm kiếm theo tên, email..." value="@ViewBag.SearchTerm">
                <button type="submit" class="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        @if (Model == null || !Model.Any())
        {
            <div class="volunteer-card">
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4 style="color: #007bbf; margin-bottom: 15px;">Chưa có dữ liệu</h4>
                    <p>Hiện tại chưa có thông tin volunteer nào trong hệ thống.</p>
                </div>
            </div>
        }
        else
        {
            <!-- Info Cards -->
            <div class="info-cards">
                <div class="info-card">
                    <div class="info-card-number">@totalCount</div>
                    <div class="info-card-label">Tổng Volunteer</div>
                </div>
                <div class="info-card">
                    <div class="info-card-number">@currentPage</div>
                    <div class="info-card-label">Trang hiện tại</div>
                </div>
                <div class="info-card">
                    <div class="info-card-number">@totalPages</div>
                    <div class="info-card-label">Tổng số trang</div>
                </div>
            </div>

            <!-- Volunteer List Table -->
            <div class="volunteer-card">
                <div class="table-container">
                    <table class="table custom-table">
                        <thead>
                            <tr>
                                <th class="stt-column">STT</th>
                                <th>
                                    <i class="fas fa-user mr-2"></i>Tên Volunteer
                                </th>
                                <th>
                                    <i class="fas fa-envelope mr-2"></i>Email
                                </th>
                                <th>
                                    <i class="fas fa-phone mr-2"></i>Số điện thoại
                                </th>
                                <th>
                                    <i class="fas fa-calendar mr-2"></i>Ngày tham gia
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null)
                            {
                                @foreach (var volunteer in Model.Select((value, index) => new { value, index }))
                                {
                                    <tr>
                                        <td class="stt-column">@(startIndex + volunteer.index + 1)</td>
                                        <td class="name-column">
                                            <i class="fas fa-user-circle mr-2" style="color: #007bbf;"></i>
                                            @volunteer.value.Name
                                        </td>
                                        <td class="email-column">@volunteer.value.Email</td>
                                        <td class="phone-column">@volunteer.value.PhoneNumber</td>
                                        <td class="date-column">
                                            @(volunteer?.value.JoinDate != null ? volunteer.value.JoinDate.Value.ToString("dd/MM/yyyy") : "N/A")
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination Section -->
            <div class="pagination-section">
                <!-- Page Size Selector -->
                @* <div class="page-size-selector"> *@
                @*     <span>Hiển thị:</span> *@
                @*     <select class="page-size-select" onchange="changePageSize(this.value)"> *@
                @*         <option value="5" selected="@(pageSize == 5 ? "selected" : null)">5</option> *@
                @*         <option value="10" selected="@(pageSize == 10 ? "selected" : null)">10</option> *@
                @*         <option value="25" selected="@(pageSize == 25 ? "selected" : null)">25</option> *@
                @*         <option value="50" selected="@(pageSize == 50 ? "selected" : null)">50</option> *@
                @*     </select> *@
                @* </div> *@

                <!-- Pagination Links -->
                @if (totalPages > 1)
                {
                    <div class="custom-pagination">
                        <nav>
                            <ul class="pagination">
                                <!-- First Page -->
                                @if (currentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Volunteer_List", new { page = 1, pageSize, searchTerm = ViewBag.SearchTerm })">
                                            <i class="fas fa-angle-double-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Volunteer_List", new { page = currentPage - 1, pageSize, searchTerm = ViewBag.SearchTerm })">
                                            <i class="fas fa-angle-left"></i>
                                        </a>
                                    </li>
                                }
                                else
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link"><i class="fas fa-angle-double-left"></i></span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link"><i class="fas fa-angle-left"></i></span>
                                    </li>
                                }

                                <!-- Page Numbers -->
                                @{
                                    int startPage = Math.Max(1, currentPage - 2);
                                    int endPage = Math.Min(totalPages, currentPage + 2);
                                }

                                @for (int i = startPage; i <= endPage; i++)
                                {
                                    if (i == currentPage)
                                    {
                                        <li class="page-item active">
                                            <span class="page-link">@i</span>
                                        </li>
                                    }
                                    else
                                    {
                                        <li class="page-item">
                                            <a class="page-link" href="@Url.Action("Volunteer_List", new { page = i, pageSize, searchTerm = ViewBag.SearchTerm })">@i</a>
                                        </li>
                                    }
                                }

                                <!-- Next Page -->
                                @if (currentPage < totalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Volunteer_List", new { page = currentPage + 1, pageSize, searchTerm = ViewBag.SearchTerm })">
                                            <i class="fas fa-angle-right"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Volunteer_List", new { page = totalPages, pageSize, searchTerm = ViewBag.SearchTerm })">
                                            <i class="fas fa-angle-double-right"></i>
                                        </a>
                                    </li>
                                }
                                else
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link"><i class="fas fa-angle-right"></i></span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link"><i class="fas fa-angle-double-right"></i></span>
                                    </li>
                                }
                            </ul>
                        </nav>
                    </div>
                }

                <!-- Pagination Info -->
                <div class="text-center mt-3" style="color: #546e7a;">
                    Hiển thị @(startIndex + 1) - @(Math.Min(startIndex + pageSize, totalCount))
                    trong tổng số @totalCount volunteer
                </div>
            </div>
        }
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('liveSearch');
            let timeout = null;

            input.addEventListener('input', function () {
                clearTimeout(timeout);
                timeout = setTimeout(function () {
                    const query = input.value;
                    const url = '@Url.Action("Volunteer_List", "Home")' + '?searchTerm=' + encodeURIComponent(query);
                    window.location.href = url;
                }, 500); // Wait 500ms after typing stops to send request
            });
        });

        function changePageSize(pageSize) {
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('pageSize', pageSize);
            currentUrl.searchParams.set('page', 1); // Reset to page 1 when changing page size
            window.location.href = currentUrl.toString();
        }
    </script>
}