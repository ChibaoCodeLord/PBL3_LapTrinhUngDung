@{
    ViewData["Title"] = "Thống kê tổng quát";
    Layout = "~/Areas/Organization/Views/OrgLayout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<div class="container-fluid">
    <!-- Overview Statistics -->
    <!-- Phần tiêu đề -->
    <div class="header-section border rounded p-4 mb-4" style="background-color: #ffffff;">
        <h1 class="text-center my-4 heading-title">DashBoard</h1>
    </div>
    <div class="row g-4  mb-4 mt-4">
        <div class="col-md-6 col-lg-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="me-3 bg-success bg-opacity-25 rounded p-3">
                        <i class="bi bi-person-lines-fill fs-2 text-success"></i>
                    </div>
                    <div>
                        <h6 class="text-danger fw-bold">TỔNG TÌNH NGUYỆN VIÊN</h6>
                        <h4 class="fw-bold">@ViewBag.TotalVolunteers tình nguyện viên</h4>
                        <small class="text-muted">Tổng số tình nguyện viên được quản lý.</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="me-3 bg-primary bg-opacity-25 rounded p-3">
                        <i class="bi bi-calendar-event fs-2 text-primary"></i>
                    </div>
                    <div>
                        <h6 class="text-danger fw-bold">TỔNG SỰ KIỆN</h6>
                        <h4 class="fw-bold">@ViewBag.TotalEvents sự kiện</h4>
                        <small class="text-muted">Tổng số sự kiện đã tổ chức.</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="me-3 bg-warning bg-opacity-25 rounded p-3">
                        <i class="bi bi-pencil-square fs-2 text-warning"></i>
                    </div>
                    <div>
                        <h6 class="text-danger fw-bold">TỔNG ĐĂNG KÝ</h6>
                        <h4 class="fw-bold">@ViewBag.TotalRegistrations lượt</h4>
                        <small class="text-muted">Tổng số lượt đăng ký tham gia.</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="me-3 bg-danger bg-opacity-25 rounded p-3">
                        <i class="bi bi-exclamation-triangle-fill fs-2 text-danger"></i>
                    </div>
                    <div>
                        <h6 class="text-danger fw-bold">CHƯA ĐÁNH GIÁ</h6>
                        <h4 class="fw-bold">@ViewBag.UncompletedEvaluations đánh giá</h4>
                        <small class="text-muted">Lượt chưa đánh giá hoàn thành.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Time-based Statistics -->
    <div class="row g-4 mb-4">
        <!-- Registrations by Month/Year -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Số Lượt Đăng Ký Theo Tháng</h5>
                </div>
                <div class="card-body">
                    <canvas id="registrationsChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <!-- Events by Quarter -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Số Lượng Sự Kiện Theo Tháng</h5>
                </div>
                <div class="card-body">
                    <canvas id="eventsByMonthChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <!-- New Volunteers by Month/Quarter -->
       

    </div>
    <div class="row g-4 mb-4">
        <!-- Registrations by Month/Year -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Tình Nguyện Viên Mới Theo Tháng</h5>
                </div>
                <div class="card-body">
                    <canvas id="volunteersByMonthChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <!-- Events by Quarter -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Số lượt quyên góp theo tháng</h5>
                </div>
                <div class="card-body">
                    <canvas id="donationsByMonthChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <!-- New Volunteers by Month/Quarter -->


    </div>

    <!-- Event-based Statistics -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Thống Kê Theo Sự Kiện</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sự Kiện</th>
                                <th>Lượt Đăng Ký</th>
                                <th>Được Duyệt</th>
                                <th>Tỉ Lệ Hoàn Thành</th>
                            </tr>
                        </thead>
                        <tbody>
                          
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Statistics -->
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Đánh Giá Sự Kiện</h5>
                </div>
                <div class="card-body">
                    <p><strong>Điểm đánh giá trung bình:</strong> @ViewBag.AverageRating</p>
                    <p><strong>Sự kiện cao nhất:</strong> @ViewBag.HighestRatedEvent</p>
                    <p><strong>Sự kiện thấp nhất:</strong> @ViewBag.LowestRatedEvent</p>
                    <p><strong>Số lượt đánh giá có feedback:</strong> @ViewBag.FeedbackCount</p>
                </div>
            </div>
        </div>
        <!-- Donation Statistics -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold text-dark mb-0">Thống Kê Quyên Góp</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sự Kiện</th>
                                <th>Tổng Số Tiền</th>
                                <th>Số Người Tham Gia</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .bg-teal {
        background-color: #20c997 !important;
    }

    .text-teal {
        color: #20c997 !important;
    }

    .bg-indigo {
        background-color: #6610f2 !important;
    }

    .text-indigo {
        color: #6610f2 !important;
    }

    .bg-amber {
        background-color: #ffc107 !important;
    }

    .text-amber {
        color: #ffc107 !important;
    }

    .bg-red {
        background-color: #dc3545 !important;
    }

    .text-red {
        color: #dc3545 !important;
    }
</style>

<script>
       async function loadRegistrationChart() {
        const response = await fetch('/Organization/Statistics/GetRegistrationByMonth');
        const data = await response.json();

        // Chuẩn bị 12 tháng mặc định
        const labels = Array.from({ length: 12 }, (_, i) => `Tháng ${i + 1}`);
        const counts = Array(12).fill(0); // Mặc định 0 lượt

        // Đổ dữ liệu thực tế vào mảng counts
        data.forEach(item => {
            const monthIndex = item.month - 1; // Vì tháng bắt đầu từ 1
            counts[monthIndex] = item.count;
        });

        const ctx = document.getElementById('registrationsChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Lượt Đăng Ký',
                    data: counts,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });
    }
       window.addEventListener('DOMContentLoaded', loadRegistrationChart);
        async function loadEventsByMonthChart() {
            const response = await fetch('/Organization/Statistics/GetEventsByMonth');
            const data = await response.json();

            const labels = Array.from({ length: 12 }, (_, i) => `Tháng ${i + 1}`);
            const counts = Array(12).fill(0);

            data.forEach(item => {
                const index = item.month - 1;
                counts[index] = item.count;
            });

            const ctx = document.getElementById('eventsByMonthChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Số lượng sự kiện',
                        data: counts,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        window.addEventListener('DOMContentLoaded', loadEventsByMonthChart);

    async function loadVolunteersByMonthChart() {
        const response = await fetch('/Organization/Statistics/GetNewVolunteersByMonth');
        const data = await response.json();

        const labels = Array.from({ length: 12 }, (_, i) => `Tháng ${i + 1}`);
        const counts = Array(12).fill(0);

        data.forEach(item => {
            const index = item.month - 1;
            counts[index] = item.count;
        });

        const ctx = document.getElementById('volunteersByMonthChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Tình nguyện viên mới',
                    data: counts,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    window.addEventListener('DOMContentLoaded', loadVolunteersByMonthChart);




        const donationsByMonthChart = new Chart(document.getElementById('donationsByMonthChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6'],
            datasets: [{
                label: 'Lượt Quyên Góp',
                data: [50, 70, 60, 90, 110, 80],
                backgroundColor: 'rgba(153, 51, 255, 0.7)', // Purple color
                borderColor: 'rgba(153, 51, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>